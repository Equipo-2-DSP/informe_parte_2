\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[spanish,es-tabla]{babel}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{float}
\usepackage{hyperref}
%\usepackage{subfigure} 
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage[usenames]{color}
\usepackage{subcaption}
\usepackage[left=3cm,right=2cm,top=3cm,bottom=3cm]{geometry}
\author{Gatica, Isaias \\ Martin, Santiago \\ Saez, Lautaro Ándres \\ Vidman, Xavier Harry}
\title{Procesamiento digital de señales: estimación del espectro de una señal aperiódica}
\date{}
\begin{document}
\maketitle
\section{Análisis de una señal aperiódica y discreta}
En esta sección se analiza el uso de la DFT para estimar el espectro de una señal aperiódica y discreta. Para ello, se considera en primera instancia la siguiente señal:

\begin{equation}
    x[n]=\delta[n]+\delta[n-1]+\delta[n-2]+\delta[n-3]
    \label{eq.xn}
\end{equation}

Para comenzar el estudio se calcula la DTFT y la DFT de la ecuación (\ref{eq.xn}), a fin de realizar una comparación entre los resultados, y poder concluir si es posible utilizar a la DFT para obtener de forma exacta o aproximada la DTFT de una señal aperiódica.

    \subsection{Cálculo de la DTFT y la DFT}

    Utilizando la definción de la DTFT\footnote{Dimitris Manolakiv and Vinay Ingle - ``Applied Digital Signal Processing'' 5th Edition.}:
    \begin{equation}
        X(e^{j\omega})=\sum_{n=-\infty}^{\infty}x[n]e^{-j\omega n}
    \end{equation}
    Donde: 
    \begin{equation}
        \label{omega}
        \omega=2\pi f
    \end{equation}
    Se llega a que la DTFT de la ecuación \ref{eq.xn} es:
    \begin{equation}
        X(e^{j\omega})=1+e^{-j\omega}+e^{-2j\omega}+e^{-3j\omega}
        \label{DTFT.R}
    \end{equation}
    Siguiendo con el análisis, se calcula la DFT utilizando la siguiente definición\footnote{Idem 1.}:
    \begin{equation}
        X[k]=\sum_{n=0}^{N-1}x[n]e^{-j\omega_k n} \qquad , 0 \leq k \leq 7
    \end{equation}
    Donde:
    \begin{equation}
        \label{omega.k}
        \omega_k=\frac{2\pi k}{N}
    \end{equation}
    Obteniendo como resultado:
    \begin{equation}
        \label{DFT.R}
        X[k]=1 + e^{-j \frac{\pi}{4} k} + e^{-j \frac{\pi}{2} k} + e^{-j \frac{3 \pi}{4} k}
    \end{equation}
    
    Al cotejar los resultados obtenidos, se observa que las expresiones son muy similares. La diferencia recae en las frecuencias de las exponenciales. La DTFT expresada en la ecuación (\ref{DTFT.R}) tiene como variable una frecuencia $\omega$ que recorre todos los valores de $f$, dando como resultado un espectro continuo. En cambio, la DFT posee una variable $k$ discreta, que recorre solo los valores enteros entre 0 y $N$. Lo mencionado se puede observar en la figura \ref{fig.3a}.
    
    
    \begin{figure}[htb]
    \centering
	\includegraphics[width=.5\textwidth]{Img/punto_3_a.png}
	\caption{DTFT de la señal $x[n]$}
	\label{fig.3a}
    \end{figure}
    
    De los gráficos mostrados en la figura \ref{fig.3a}, tiene sentido concluir que la DFT muestrea a la DTFT, utilizando los N valores que se le adjudicaron para realizar el cálculo. En la ecuación (\ref{omega.k}) se aprecia como la DFT discretiza la frecuencia angular, dando como resultado que sobre dicha transformada, la DTFT actúe de envolvente. Sin más preámbulos, no se puede obtener de forma exacta la DTFT a partir de la DFT, al ser una expresión que involucre una variable continua.
    
    %Al comparar los resultados, ecuación \ref{DTFT.R} con ecuación \ref{DFT.R}, se observa que la diferencia recae en la frecuencia. Debido a esto, en la ecuación 
    %\ref{DTFT.R} la frecuencia asociada es la ecuación \ref{omega} que toma valores para todo $f$ dando como resultado un espectro continuo en frecuencia. Esto es un incoveniente a la hora 
    %de realizar el cálculo numérico (por los infinitos valores).Por esto para la \textit{DFT} se discretiza la frecuencia angular dando como resultado la ecuación \ref{omega.k}. Se concluye que es imposible encontrar de forma exacta la \textit{DTFT} a partir de la \textit{DFT}. En otras palabras, se puede decir que 
    %la \textit{DFT} muestrea el espectro continuo de la \textit{DTFT}.

    \subsection{Cálculo de la DFT con distintos puntos}    
    Continuando con el estudio de la DFT, se realiza su cálculo de forma numérica utilizando la \textit{fft}. Para llevar esto a cabo, se genera la señal de la ecuación (\ref{eq.xn}) para los siguientes valores de N: 3, 4 y 8. Los resultados de los tres casos están presentados en la figura \ref{fig.3b}, junto con una señal punteada que corresponde al espectro real de la señal $x[n]$:

    \begin{figure}[htb]
    \centering
    \includegraphics[width=\textwidth]{Img/punto_3_b.png} 
    \caption{Espectros generados con N=3, N=4 y N=8.}
    \label{fig.3b}
    \end{figure}
    
    Analizando los resultados de la figura \ref{fig.3b}, se puede ver que tomar 3 puntos de la señal original difiere con los resultados de la envolvente, y al continuar realizando pruebas con otros valores de N, se observa que al tomar valores de $N$ por debajo de 4, el espectro obtenido a través de la \textit{fft} posee valores diferentes al original. Esto sucede porque se está recortando la señal $x[n]$, y por ende, perdiendo información, lo que termina en un espectro erróneo.
    Asimismo, los valores de la DFT coinciden con el valor de la envolvente en los casos que $N=4$ y $N=8$. Extrapolando estos resultados, se puede decir que para cualquier valor de $N$ mayor a 4, los valores calculados por la \textit{fft} coinciden con los valores de la envolvente.

    \subsection{DFT con zero-padding}
    En esta sección, se realiza el cálculo de la DFT de la señal (\ref{eq.xn}), pero esta vez, con el objetivo de estudiar el efecto del \textit{zero-padding}. Dicho efecto consiste en rellenar con ceros una señal hasta un número determinado de puntos. En este caso, se tomaron las señales anteriores (valores de N: 3, 4 y 8) y se rellenaron con ceros hasta tener 256 puntos, para luego calcular su DFT mediante la \textit{fft}. Los resultados obtenidos se muestran en la figura \ref{fig.1c}.
    
    \begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{Img/punto_3_c.png}
    \caption{\textit{fft} con zero-padding hasta 256 puntos para 3,4 y 8 puntos de la señal $x[n]$}
    \label{fig.1c}
    \end{figure}
    
    Al observar la figura \ref{fig.1c}, se concluye que el método \textit{zero-padding} no agrega más información al espectro, sino que solo permite una mejor visualización del espectro real de señal. No obstante, por más que se utilice el \textit{zero-paddding}, si no se realiza con todos los valores distintos de cero de la señal $x[n]$, la aproximación seguirá siendo incorrecta.
    
    %Ahora es posible observar de mejor manera, lo comentado en el apartado anterior, como el zero-padding no agrega mas información al espectro sino que permite una mejor visualización del mismo, cuando se toman 3 puntos de la señal original, no se llega a tomar la señal completa si no que se recorta, por lo que el espectro si bien un aspecto similar, es mas ancho y de menor amplitud (al ser un cajon de 3 puntos y no de 4 puntos como la señal original), y para los casos de N=4 y N=8 que si se utiliza toda la información de la señal $x[n]$ se ve claramente que los valores de la DFT corresponden a muestras de la DTFT.


    \subsection{Aproximación de la DTFT utilizando la \textit{fft}}
        En el siguiente apartado se concluye sobre las condiciones necesarias que debe tener una señal aperiódica, para lograr aproximar de una manera correcta el cálculo de su DTFT con el algoritmo \textit{fft}. 
        
        
        De los análisis anteriores se sabe que la DFT muestrea al espectro continuo de una señal $x[n]$ aperiódica. Por lo tanto, se afirma que no existe una manera numérica de calcular la DTFT para señales aperiódicas, ya que se necesitaría almacenar infinitos valores para realizarlo. La siguiente ecuación expresa la relación que hay entre la frecuencia discretizada de la DFT con la frecuencia de la DTFT: 
        
        \begin{equation}
            X[k]=X_{DTFT}\left(  \frac{2 \pi}{N} k \right)
        \end{equation}

        Donde $N$ es el número de puntos que se utilizan para calcular la DFT.

        No obstante, hay ciertas condiciones que se deben cumplir para lograr una buena aproximación, y para que los valores obtenidos de la \textit{fft} sean considerados muestras del espectro real de la señal. Las condiciones son las siguientes:

        \begin{enumerate}
            \item La señal debe ser de duración finita ($L$).
            \item Al realizar el cálculo numérico, utilizar al menos $L$ puntos.
        \end{enumerate}
    
    \subsection{Código para la obtención de la DTFT:}
    En esta sección se utiliza el código adjunto a este informe para calcular la DTFT de tres señales aperiódicas discretas. En principio, se calcula la DTFT de forma teórica. Luego, se muestra en gráficos el resultado obtenido de forma numérica.
    

    \subsubsection*{i) Primera señal:}

    \begin{equation}
    x_{1}[n] = \left\{ 
        \begin{array}{ll} 
        n & \mathrm{si\ } 0\leq n \leq 4 \\
        10-n & \mathrm{si\ } 5\leq n \leq 10 \\
        0 & \mathrm{sino\ } \\
        \end{array} 
        \right.
    \end{equation}
    
    
    Resultado teórico:
    
    
    \begin{equation}
    X_{1}(e^{j \omega})=25 sinc^{2}\left(\frac{5 \omega}{2 \pi}\right) e^{- j \omega} 
    \end{equation}

    \subsubsection*{ii) Segunda señal:}

    \begin{equation} 
        x_{2}[n] = \left\{ 
        \begin{array}{ll} 
        1 & \mathrm{si\ } -2\leq n \leq +2, \\
        0 & \mathrm{sino\ } \\
        \end{array} 
        \right.
    \end{equation}

    Resultado teórico:
    
    \begin{equation}
    X_{2}(e^{j \omega})= \frac{sin(\frac{ \omega 5}{2})}{sin (\frac{\omega}{2})}
    \end{equation}

    \subsubsection*{iii) Tercera señal:}

    \begin{equation} 
        x_{3}[n]=(-0,5)^{n}u[n]
    \end{equation}
    
    Resultado teórico:
    
    \begin{equation}
    X(e^{j \omega})=\frac{1}{1+0,5 e^{j \omega}}
    \end{equation}
    
    A continuación, se pueden observar los resultados de la DTFT de forma numérica en las siguientes figuras:
    
    \begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{Img/punto_3_e_1.png}
    \caption{espectro de la señal $x_{1}[n]$ mediante el algoritmo.}
    \label{fig.3ei}
    \end{figure} 


    \begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{Img/punto_3_e_2.png}
    \caption{espectro de la señal $x_{2}[n]$ mediante el algoritmo.}
    \label{fig.3eii}
    \end{figure}


    \begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{Img/punto_3_e_3.png}
    \caption{espectro de la señal $x_{3}[n]$ mediante el algoritmo.}
    \label{fig.3eiii}
    \end{figure}

    Se puede apreciar que los espectros representados en las figuras \ref{fig.3ei},\ref{fig.3eii} y \ref{fig.3eiii} coinciden de manera aproximada con lo obtenido de manera teórica. 
    
    
%\begin{figure}[htb]
%\begin{subfigure}{.6\textwidth}
%  \centering
  % include first image
%  \includegraphics[width=.8\linewidth]{Img/punto_3_b.png}  
%  \caption{Put your sub-caption here}
%  \label{fig:sub-first}
%\end{subfigure}
%\begin{subfigure}{.6\textwidth}
%  \centering
  % include second image
%  \includegraphics[width=\linewidth]{Img/punto_3_c.png}  
%  \caption{Put your sub-caption here}
%  \label{fig:sub-second}
%\end{subfigure}
%\caption{Put your caption here}
%\label{fig:fig}
%\end{figure}


\section{Ejercicio 4}

\subsection{Calculo de la CTFT}
\begin{equation}
    x(t)=u(t-3)-u(t)
\end{equation}
Utilizando la definción de la CTFT:
\begin{equation}
    X(j\Omega)=\int_{-\infty}^{\infty} x(t)e^{-j\Omega t}dt
\end{equation}
Y analizando que la señal $x(t)$ resulta ser un cajon de amplitud negativa en el intervalo del tiempo $0\leq t \leq 3$:
\begin{equation}
    X(j\Omega)=\int_{0}^{3} -1e^{-j\Omega t}dt
\end{equation}
\begin{equation}
    X(j\Omega)=\frac{1}{j\Omega} \left[e^{-j\Omega t} \vert_{3}^{0}\right] = \frac{e^{-3j\Omega} - 1}{j\Omega}
\end{equation}
Si acomodamos la ecuación anterior llegamos a:
\begin{equation}
    X(j\Omega) = -3e^{\frac{-3j\Omega}{2}} sinc(3F)
\end{equation}
\subsection{Muestreo y calculo de la DFT}
Para el cálculo de la \textit{DFT} se muestrea la señal $x(t)$ utilizando una frecuencia de muestreo $F_s=1Hz$ con la intencíon de obtener 4 muestras del intervalo distinto de cero de la señal original. El resultado de
este muestreo es igual a la ecuación \ref{S.disc} pero invertida en amplitud. Luego, aplicamos la ecuación \ref{DFT} utilizando $N=4$ con el fin de utilizar todas las muestras distintas de cero:
\begin{equation}
    X[k]=\sum_{n=0}^{3}-1e^{-j\omega_k n} = \frac{1 - e^{-j4\omega_k}}{1-e^{-j\omega_k}} = e^{-j\frac{3}{4}\pi k} \frac{sin(\pi k)}{sin(\pi k/4)}
\end{equation} 

Si hacemos un analisis de las ecuaciones utilizadas para el calculo de la DFT y la DFTF, siendo la ecuacion de la DTFT: 
\begin{equation}
    \label{DTFT}
	\tilde{X}(e^{j \omega T}) = \sum_{n=- \infty}^{\infty} x_{c}(nT) e^{-j \omega nT}=\frac{1}{T}\sum_{m=- \infty}^{\infty} X_{c} \left(j \omega - j \frac{2 \pi}{T}	m \right)	
\end{equation}
 donde $x_{c}(nT)$ son las muestras de $x_{c}(t)$.
 Con los resultados obtenidos del analisis de una señal aperidioca discreta, se obtuvo que la relacion entre la DTFT y la DFT viene dada por el muestreo en frecuencia de la DFTF por parte de la DFT, la relacion
se ve en la ecuacion (omega.k creo que era Xavi). Reemplazando dicha relación en la ecuacion (\ref{DTFT}) se obtiene la expresion de la DFT :
 \begin{equation}
 X[k] = \frac{1}{T}\sum_{m=- \infty}^{\infty} X_{c} \left(j \frac{2 \pi k }{N} - j \frac{2 \pi}{T}	m \right)    k =0,1..., N-1 \\
 \end{equation}
 quedando entonces expuesta la relacion entre ambas.
 
 Si ahora queremos analizar la relacion existente entre la DTFT y la CTFT, solo basta con realizar un nuevo analisis de la ecuacion (\ref{DTFT}), en ella se puede ver implicita la relacion buscada.
 Por inspeccion de la ultima expresion, vemos que la DFTF de la señal muestrada no es mas que la periodización del espectro de la señal continua original.
 En resumen la relacion entre la DTFT y la CTFT es que la DTFT es un espectro periodico con posible aliasing de la señal CTFT.
 
 \subsection{ Cálculo aproximado de la CTFT}

Se establece como frecuencia de muestreo $F_s=1Hz$, ya que dicha frecuencia es mayor a 2 veces la frecuencia del primer cero, por lo tanto la señal
muestreada conserva el $90\%$ de la energía de la señal original. Obteniendo 

\begin{equation}
    x[n]=-\mu[n]\mu[3-n]
\end{equation}

En general se puede establecer que para cualquier frecuencia de muestreo $F_s$ se obtiene 

\begin{equation}
    x_{F_s}[n]=-\mu[n]\mu[3F_s-n]
\end{equation}

Donde el ancho del pulso esta determinado directamente por el valor de $F_s$.

Luego al realizar una variación de frecuencia se obtiene que a mayor $F_s$ mejor es la paroximación, esto se debe a que el espectro de la 
señal de $x(t)$ no es de banda limitada, y por lo tanto siempre existira aliasing.  

\begin{figure}[H]
    \centering
    %\includegraphics[width=\textwidth]{Img/punto_4_d.png}
    \caption{Aproximacion de la CTFT mediante la \textit{fft} para distintos valores de $F_s$ y con zero padding hasta $1024muestras$.}
    \label{fig.4d}
\end{figure}

Al observar la Figura \ref{fig.4d} se observa que para $F_s=1Hz$ es posible recuperar los 2 primeros lobulos del espectro, pero su amplitud 
tiene un error notorio. Mientras que si bajamos la frecuencia a $F_s=0.5Hz$ solo recuperamos 1 solo lobulo, y el aliasing debido al mal muestreo de 
la señal es muy notorio. Si utilizamos frecuencia menores a $0.4Hz$ se obtiene una señal continua debido al gran aliasing sufrido por la superposición
del lobulo central. Al aumentar $F_s$ hasta $10Hz$ se observa que la aproximación del espectro mejora mucho en cuanto a la amplitud y se pueden recuperar 
muchos mas lobulos.

 \subsubsection*{calculo aproximado de la CTFT con FFT con N=10 y N=1000}
 se muestrea la señal $x_{c}(t)$ a la frecuencia $Fs=3 Hz$ y se obtuvo una señal $x[n]$ la cual consta de 9 puntos diferentes de cero, para luego calcularse la DFT con 2 valores de N distinto; N=10 y N=1000, se obtuvo el siguiente resultado:
 \begin{figure}
 \centering
     %\includegraphics[width=\textwidth]{Img/punto_4_e.png}
     \caption{DFT de la señal x[n] para N=10 y N=1000}
     \label{fig.4e}
 \end{figure} 
 Si se observa la figura \ref{fig.4e} se da la ilusion de que al utilizar un numero mayor de puntos para el calculo de la DFT, el resultado seria mas exacto , ya que se parece mas al espectro teorico, pero como la señal pasados los 9 puntos son solo ceros, al tomar N=1000 las muestras adicionales no contienen informacion, la frecuencia a la que se distribuye los valores de la DFT en el espectro disminuye (ver la relacion en la ecuacion \ref{omega.k})
 lo que genera una mejor visualizacion del espectro, pero no agrega informacion adicional, por lo tanto la estimacion de la CTFT es la misma.

 \subsection{ CTFT a partir de la DFT }
 Para el cálculo de la CTFT utilizando la DFT se realizan los siguientes pasos:
 \begin{itemize}
     \item Obtención de la señal $x[n]$ muestreando la señal $x(t)$ con una frecuencia $F_s$.
     \item Implementar el algoritmo de la fft a la señal muestreada.
     \item Normalizar el resultado obtenido de la fft dividiendo por $F_s$.
     \item VER - Filtrar un periodo del espectro obtenido de la DFT - VER
 \end{itemize}

 Bajo ninguna condición la estimación de la CTFT puede ser exacta debido a su naturelaza continua y los problemas numericos que esto conlleva. Sin embargo, se puede obtener una 
 estimación precisa si se eligen de manera correcta los siguientes parametros:
 \begin{enumerate}
     \item Frecuencia de muestreo: se debe elegir una $F_s$ que cumpla el teorema de muestreo (ref). Esta condición se ve reflejada en el \textit{aliasing} resultante del espectro. Si bien el espectro siempre va presentar aliasing (debido a que se esta muestreando una señal aperiódica) éste se puede disminuir al utilizar $F_s$ cada vez mayores.
     \item Cantidad de muestras: se debe elegir una cantidad de muestras $N$ mínima que contenga la información de la señal muestreada. A partir de esta idea se desprenden dos situaciones:
     \begin{itemize}
         \item Señal $x[n]$ de duración finita: En este caso si la longitud de la señal es igual a $L$, la cantidad de muestras debe ser $N \geq L$.
         \item Señal $x[n]$ de duración infinita: En este caso la cantidad de muestras $N$ debe ser lo mas representativa posible, es decir mientras mayor sea $N$ mejor sera la aproximación.
     \end{itemize}
\end{enumerate}

Por último, el efecto del método zero-padding tiene como finalidad mejorar la visualización del espectro. (Esto se desarrollo en la sección (ref)).








\end{document}